<app-header [logoEmpresa]="logoEmpresa"></app-header>

<div class="bottom-messages">

  <div #scrollContainer class="main-container">
    @if (conversaIa.length > 0) {
      @for (perguntaResposta of conversaIa; track perguntaResposta) {
        <app-ia-message
          [logoEmpresa]="logoEmpresa"
          [mensagemIa]="perguntaResposta?.iaMessage">
        </app-ia-message>

        <app-user-message
          [mensagemUser]="perguntaResposta?.userMessage">
        </app-user-message>
      }
    }
    @if (perguntaSelecionada && !digitando) {
      <app-pergunta-solicitacao
        (enviaRespostaAnexo)="recebeAnexo($event)"
        (enviaRespostaUsuario)="recebeResposta($event)"
        [perguntaSolicitacao]="perguntaSelecionada"></app-pergunta-solicitacao>
    } @else if (digitando) {
      <app-message-loading></app-message-loading>
    }
    @let podeConfirmar = finalizado && !solicitacaoFinalizada;
    @switch (true) {
      @case (podeConfirmar) {
        <button
          (click)="finalizarAgendamento()"
          [disabled]="UtilsService.loading.value"
          class="btn-confirmar btn-agendamento"
          color="primary"
          matButton="filled"
          type="button">
          <div class="d-flex flex-row align-items-center">
            @if (UtilsService.loading.value) {
              <b>CRIANDO AGENDAMENTO, AGUARDE...</b>
              <mat-spinner class="ml-3"></mat-spinner>
            } @else {
              <b>CONFIRMAR AGENDAMENTO</b>
              <mat-icon class="home-btn-icon">assignment_turned_in</mat-icon>
            }
          </div>
        </button>
        @if (!UtilsService.loading.value) {
          <button
            (click)="iniciarNovaSolicitacao()"
            [disabled]="UtilsService.loading.value"
            class="btn-reiniciar-agendamento mt-0"
            matButton="filled"
            type="button">
            <div class="d-flex flex-row align-items-center">
              <b>N√ÉO, REINICIAR AGENDAMENTO</b>
              <mat-icon class="home-btn-icon">close</mat-icon>
            </div>
          </button>
        }
      }
      @case (finalizado && solicitacaoFinalizada) {
        <button
          (click)="iniciarNovaSolicitacao()"
          [disabled]="UtilsService.loading.value"
          class="btn-confirmar btn-novo-agendamento"
          matButton="outlined"
          type="button">
          <div class="d-flex flex-row align-items-center">
            <b>INICIAR NOVO AGENDAMENTO</b>
            <mat-icon class="home-btn-icon">arrow_forward</mat-icon>
          </div>
        </button>
      }
    }
  </div>
</div>
<app-footer [logoEmpresa]="logoEmpresa">
</app-footer>