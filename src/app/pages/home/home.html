<app-header></app-header>

<div #scrollContainer class="main-container">
  @if (conversaIa.length > 0) {
    @for (perguntaResposta of conversaIa; track perguntaResposta.index) {
      <app-ia-message-2
        [mensagemIa]="perguntaResposta?.iaMessage">
      </app-ia-message-2>
      <app-user-message-2
        [mensagemUser]="perguntaResposta?.userMessage">
      </app-user-message-2>
    }
  }
  @if (perguntaSelecionada && !digitando) {
    <app-pergunta-solicitacao
      (enviaRespostaUsuario)="recebeResposta($event)"
      [perguntaSolicitacao]="perguntaSelecionada"></app-pergunta-solicitacao>
  } @else {
    <app-ia-message-loading></app-ia-message-loading>
  }
  @let logado = !!authService.pessoaValue?.cli_codigo && !!authService.pessoaValue?.pes_codigo;
  @let podeConfirmar = finalizado && !solicitacaoFinalizada;
  @switch (true) {
    @case (podeConfirmar && logado) {
      <button
        class="btn-confirmar btn-agendamento"
        color="primary"
        matButton="filled"
        type="button"
        (click)="finalizarAgendamento()">
        <div class="d-flex flex-row align-items-center">
          <b>CONFIRMAR AGENDAMENTO</b>
          <mat-icon class="home-btn-icon">assignment_turned_in</mat-icon>
        </div>
      </button>
    }
    @case (podeConfirmar && !logado) {
      <button
        class="btn-confirmar"
        color="primary"
        matButton="filled"
        type="button"
        (click)="login()">
        <div class="d-flex flex-row align-items-center">
          <b>ACESSAR MINHA CONTA</b>
          <mat-icon class="home-btn-icon">login</mat-icon>
        </div>
      </button>
    }
    @case (finalizado && solicitacaoFinalizada) {
      <button
        class="btn-confirmar btn-novo-agendamento"
        matButton="outlined"
        type="button"
        (click)="iniciarNovaSolicitacao()">
        <div class="d-flex flex-row align-items-center">
          <b>INICIAR NOVO AGENDAMENTO</b>
          <mat-icon class="home-btn-icon">arrow_forward</mat-icon>
        </div>
      </button>
    }
  }
</div>

<app-footer>
</app-footer>